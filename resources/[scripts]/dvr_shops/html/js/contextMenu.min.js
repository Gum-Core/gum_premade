! function(e) {
    e.fn.contextMenu = function(t, n) {
        var o = e("body"),
            i = {
                name: "",
                offsetX: 15,
                offsetY: 5,
                beforeShow: e.noop,
                afterShow: e.noop
            },
            s = e.extend(i, n || {}),
            a = {},
            c = c || "JCM_" + +new Date + (Math.floor(1e3 * Math.random()) + 1),
            r = 0,
            f = function(n) {
                var o = n || t,
                    i = "site_cm_" + (n ? r++ : c),
                    s = e('<div id="' + i + '" class="site-cm-box" style="position:absolute; display: none;">');
                e.each(o, function(t, n) {
                    if (!e.isArray(n)) throw TypeError();
                    if (t && s.append('<div class="site-cm-separ">'), n.length) {
                        var o = e('<ul class="site-cm-group">');
                        e.each(n, function(n, i) {
                            var l, u = e("<li>" + i.text + (e.isArray(i.items) && i.items.length ? f(i.items) : "") + "</li>");
                            e.isFunction(i.action) && (a[l = c + "_" + r + "_" + t + "_" + n] = i.action, u.attr("data-key", l)), o.append(u).appendTo(s)
                        })
                    }
                });
                var l = s.get(0).outerHTML;
                return s = null, l
            };
        return o.on("mousedown", function(t) {
            var n = "#site_cm_" + c;
            !e(t.target).closest(n).length && e(n).hide()
        }), this.each(function() {
            e(this).on("contextmenu", function(t) {
                e.isFunction(s.beforeShow) && !1 === s.beforeShow.call(this, t) || (t.cancelBubble = !0, t.preventDefault(), function() {
                    var t = e("#site_cm_" + c);
                    if (!t.length) {
                        var n = f();
                        t = e(n).appendTo(o), e("li", t).on("mouseover", function() {
                            e(this).addClass("hover").children(".site-cm-box").show()
                        }).on("mouseout", function() {
                            e(this).removeClass("hover").children(".site-cm-box").hide()
                        }).on("click", function() {
                            var n = e(this).data("key");
                            n && !1 !== a[n].call(this) && t.hide()
                        }), t.on("contextmenu", function() {
                            return !1
                        })
                    }
                    return t
                }().show().offset({
                    left: t.clientX + s.offsetX,
                    top: t.clientY + s.offsetY
                }), e.isFunction(s.afterShow) && s.afterShow.call(this, t))
            })
        })
    }
}(jQuery);